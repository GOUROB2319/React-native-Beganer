<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to HTML Converter</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>PDF থেকে HTML কনভার্টার</h1>
        <p>আপনার স্ক্যান করা বই আপলোড করুন এবং সেটিকে ওয়েবপেজে রূপান্তর করুন।</p>
    </header>
    <div class="container">
        <div class="upload-section">
            <h2>পিডিএফ ফাইল আপলোড করুন</h2>
            <input type="file" id="pdfFile" accept=".pdf">
            <button onclick="convertPdfToHtml()">রূপান্তর করুন</button>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script>
        async function convertPdfToHtml() {
            const fileInput = document.getElementById('pdfFile');
            if (fileInput.files.length === 0) {
                alert("অনুগ্রহ করে একটি পিডিএফ ফাইল নির্বাচন করুন।");
                return;
            }
            const file = fileInput.files[0];
            const fileReader = new FileReader();

            fileReader.onload = async function() {
                const typedarray = new Uint8Array(this.result);
                const pdf = await pdfjsLib.getDocument(typedarray).promise;
                let textContent = '';

                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const text = await page.getTextContent();
                    textContent += text.items.map(s => s.str).join(' ');
                }
                
                try {
                    const response = await fetch('http://localhost:3000/convert', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ text: textContent })
                    });

                    if (!response.ok) {
                        throw new Error('Network response was not ok.');
                    }

                    const htmlContent = await response.text();
                    const newWindow = window.open();
                    newWindow.document.write(htmlContent);
                    newWindow.document.close();
                } catch (error) {
                    console.error('Error:', error);
                    alert('রূপান্তর করার সময় একটি সমস্যা হয়েছে।');
                }
            };

            fileReader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>